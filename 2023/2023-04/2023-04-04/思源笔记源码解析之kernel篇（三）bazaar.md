---
title: 思源笔记源码解析之kernel篇（三）bazaar
date: 2023-04-05 03:05:56
categories:
 - [不看会后悔的实用技巧分享, 源码解析, 思源笔记]
tags: 
 - 思源笔记
---

## 总结

根据以上你自己的分析，对程序的整体功能和构架做出概括。然后用一张 markdown 表格整理每个文件的功能

**程序概括：**

该程序实现了思源笔记的插件化扩展功能，其中主要包括图标包、主题包、模板包、Widget 包的管理和安装。程序使用 Go 语言编写，通过 HTTP 协议访问名为 "Bazaar" 的仓库服务器上的数据，并对用户定义的配置目录进行安装和管理。

**程序文件功能表格：**

| 文件名      | 主要功能                                                                                                                                                                       |
| ------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| icon.go     | 实现了 Icon 结构体，封装了每个图标包的基本信息以及下载和安装等操作函数。主要功能包括获取所有可用图标包、获取已安装图标包、下载安装图标包、卸载图标包。                         |
| package.go  | 主要包含处理 bazaar 包的函数，如获取包的 README、下载安装包、安装包等。同时还包括了一些读取 icon、theme、widget、template 等信息的函数。在定义了一些结构体来保存这些包的信息。 |
| template.go | 实现了 Template 结构体，封装了每个模板包的基本信息以及下载和安装等操作函数。主要功能包括获取所有可用模板包、获取已安装模板包、下载安装模板包、卸载模板包。                     |
| theme.go    | 实现了 Theme 结构体，封装了每个主题包的基本信息以及下载和安装等操作函数。主要功能包括获取所有可用主题包、获取已安装主题包、下载安装主题包、卸载主题包。                        |
| widget.go   | 实现了 Widget 结构体，封装了每个 Widget 包的基本信息以及下载和安装等操作函数。主要功能包括获取所有可用 Widget 包、获取已安装 Widget 包、下载安装 Widget 包、卸载 Widget 包。   |

总体概括：该程序可以根据用户需要对思源笔记进行定制化扩展，增加不同的图标、主题、模板、Widget 等，丰富了用户的使用体验。

## [0/5] icon.go

该文件是 bazaar 工程中的一个 Go 语言源程序文件，用于实现与图标/图标包相关的功能。程序中定义了 Icon 结构体，表示一个图标，包括图标的元数据信息和图标文件的路径等。程序还定义了一系列函数，主要包括以下几个方面的功能：

1. `Icons` 函数：该函数通过网络访问 bazaar-server 获取所有可用的图标包的元数据，每个图标包的元数据包括其所在的仓库 URL、预览图片 URL、更新时间、星级、下载次数等信息，并将这些元数据封装成 Icon 对象，并将所有 Icon 对象返回，排序方式为按更新时间倒序。
2. `InstalledIcons` 函数：该函数遍历用户本地已安装的图标的目录，读取目录中的每个图标包的元数据，并与第一个功能中获取的图标包元数据进行匹配，根据匹配结果将本地已安装的图标包封装成 Icon 对象，以数组的形式返回。
3. `InstallIcon` 函数：该函数用于从 bazaar-server 下载已有的图标包并安装到本地。
4. `UninstallIcon` 函数：该函数用于从用户本地卸载指定的图标包。
5. 其他函数：包括 isBuiltInIcon 函数，用于判断指定的目录名称是否为默认提供的图标包；IconJSON 函数，用于解析指定目录中存储的图标包元数据信息；formatUpdated 函数，用于格式化日期字符串表示的时间信息；isOutdatedIcon 函数，用于判断本地已安装的图标包是否需要更新等。

## [1/5] package.go

这是一个 Go 语言编写的 bazaar 包，其中包含了一些处理 bazaar 包的函数，如获取包的 README、下载安装包、安装包等。同时还包括了一些读取 icon、theme、widget、template 等信息的函数。

在定义了一些结构体来保存这些包的信息，如 Package、Icon、Widget、Template 等。

函数主要的实现思路是从 bazaar 服务器上下载以 zip 压缩包为形式的安装包，再解压到指定的目录中。同时还包括了一些处理数据的函数，如格式化日期、获取 bazaar index 等。

## [2/5] template.go

该文件是 template.go，是一个 Go 语言编写的程序文件，主要包含以下函数和数据结构：

函数：

* Templates()：获取所有论坛模板的列表，并按更新时间排序。
* InstalledTemplates()：获取已安装论坛模板的列表。
* InstallTemplate()：安装指定的论坛模板。
* UninstallTemplate()：卸载指定的论坛模板。

数据结构：

* Template：存储论坛模板的基本信息，包括名称、作者、预览图、更新日期、大小等。其中，已安装的论坛模板还包括安装日期、版本号等信息。

## [3/5] theme.go

文件名：theme.go

该文件是一个 Golang 语言编写的主题管理模块，用于管理笔记软件思源笔记的主题。

主要功能包括：

* 获取所有可用主题
* 获取已安装的主题
* 安装一个主题
* 卸载一个主题

主题数据来自于一个名为 Bazaar 的思源笔记主题仓库，使用 HTTP 请求向仓库获取主题数据。同时该文件也使用了第三方库 ants 和 go-humanize。

## [4/5] widget.go

该程序文件是 widget.go，是一个 Go 语言编写的文件。该文件实现了一个名为 Widget 的类型，并且该类型包含一些程序所需要的属性。

其中，函数 `Widgets` 返回一个包含多个 Widget 的数组，而函数 `InstalledWidgets` 返回一个已安装 Widget 的数组。函数 `InstallWidget` 用于安装 Widget，而函数 `UninstallWidget` 用于卸载 Widget。
